$(function(){function d(e,t){var n=[-8200,8150],r=[8239,-7639],i=5087,s=4916,o=v(n[0],n[1],e/i),u=v(r[0],r[1],t/s);return[o,u]}function v(e,t,n){return n*(t-e)+e}function m(e){var n=new OpenLayers.Size(21,25);var r=new OpenLayers.Pixel(-(n.w/2),-n.h);var i=new OpenLayers.Icon("ward_observer.png",n,r);var s=t.getLonLatFromPixel(e.xy);var o=new OpenLayers.Geometry.Point(s.lon,s.lat);var u=new OpenLayers.Marker(s,i);c.addMarker(u);var a=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(s.lon,s.lat),N(1600),40);var f=new OpenLayers.Feature.Vector(a);l.addFeatures(f);u.radius_feature=f;var h=function(e){l.removeFeatures(u.radius_feature);c.removeMarker(u);OpenLayers.Event.stop(e)};u.events.register("mousedown",this,h)}function g(e){var n=new OpenLayers.Size(21,25);var r=new OpenLayers.Pixel(-(n.w/2),-n.h);var i=new OpenLayers.Icon("ward_sentry.png",n,r);var s=t.getLonLatFromPixel(e.xy);var o=new OpenLayers.Marker(s,i);c.addMarker(o);var u={strokeColor:"#007FFF",strokeOpacity:1,strokeWidth:1,fillColor:"#007FFF",fillOpacity:.4};var a=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(s.lon,s.lat),N(800),30);var f=new OpenLayers.Feature.Vector(a,null,u);l.addFeatures(f);o.radius_feature=f;var h=function(e){l.removeFeatures(o.radius_feature);c.removeMarker(o);OpenLayers.Event.stop(e)};o.events.register("mousedown",this,h)}function y(e){console.log(e)}function b(e){var t=e.geometry;var n="units";var r=e.order;var i=e.measure;var s=document.getElementById("output");var o="";if(r==1){if(e.units=="km"){o+="distance: "+(i*3214.07509338).toFixed(0)+" "+n}else{o+="distance: "+(i*3.21407509338).toFixed(0)+" "+n}}else{o+="distance: "+(i*3.21407509338).toFixed(0)+" "+n+"<sup>2</"+"sup>"}s.innerHTML=o}function w(e){var t=e.geometry;var n="units";var r=e.order;var i=e.measure;var s=document.getElementById("output");var o="";if(r==1){if(e.units=="km"){o+="radius: "+(i*3214.07509338).toFixed(0)+" "+n}else{o+="radius: "+(i*3.21407509338).toFixed(0)+" "+n}}else{o+="distance: "+(i*3.21407509338).toFixed(0)+" "+n+"<sup>2</"+"sup>"}s.innerHTML=o}function E(e){console.log(e);var t=e.geometry;var n="units";var r=e.order;var i=e.measure;var s=document.getElementById("output");var o="";if(r==1){if(i>0){if(e.geometry.components.length>2){this.cancel()}if(e.units=="km"){var u=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),i*1e3,30)}else{var u=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.geometry.components[0].x,e.geometry.components[0].y),i,30)}var a=new OpenLayers.Feature.Vector(u);f.removeFeatures(e.geometry.circle_features);if("circle_features"in e.geometry){e.geometry.circle_features.length=0;e.geometry.circle_features.push(a)}else{e.geometry.circle_features=[a]}f.addFeatures(a)}if(e.units=="km"){o+="radius: "+(i*3214.07509338).toFixed(0)+" "+n}else{o+="radius: "+(i*3.21407509338).toFixed(0)+" "+n}}else{o+="distance: "+(i*3.21407509338).toFixed(0)+" "+n+"<sup>2</"+"sup>"}s.innerHTML=o}function k(e,n,r,i,s,o){var u=new OpenLayers.Feature(e,n);u.closeBox=s;u.popupClass=r;u.data.popupContentHTML=i;u.data.overflow=o?"auto":"hidden";var a=u.createMarker();var f=function(e){if(this.popup==null){this.popup=this.createPopup(this.closeBox);t.addPopup(this.popup);this.popup.show()}else{this.popup.toggle()}currentPopup=this.popup;OpenLayers.Event.stop(e)};if(e.name=="Towers"){a.events.register("mouseover",u,f);a.events.register("mouseout",u,f)}e.addMarker(a);return a}function _(e){var n=this.map.getResolution();var r=Math.round((e.left-this.maxExtent.left)/(n*this.tileSize.w));var i=Math.round((this.maxExtent.top-e.top)/(n*this.tileSize.h));var s=t.getZoom();var o=s+"/tile_"+r+"_"+i+"."+this.type;var u=this.url;if(u instanceof Array){u=this.selectUrl(o,u)}return u+o}$("#controls-max").click(function(){$("#controlslist").toggle();$("#output").toggle();$(this).hide();$("#controls-min").show()});$("#controls-min").click(function(){$("#controlslist").toggle();$("#output").toggle();$(this).hide();$("#controls-max").show()});$("#coordControl").change(function(){if(this.checked){$("#coords").show()}else{$("#coords").hide()}});var t=new OpenLayers.Map("map",{maxExtent:new OpenLayers.Bounds(0,0,5120,5120),numZoomLevels:3,maxResolution:4,units:"m",projection:"EPSG:900913",displayProjection:new OpenLayers.Projection("EPSG:900913")});var n={npc_dota_roshan_spawner:"Roshan",dota_item_rune_spawner:"Runes",ent_dota_tree:"Trees",npc_dota_fort:"Ancients",ent_dota_shop:"Shops",npc_dota_tower:"Towers",npc_dota_barracks:"Barracks",npc_dota_building:"Buildings",trigger_multiple:"Neutral Camps Spawn Boxes",npc_dota_neutral_spawner:"Neutral Camps"};var r=new OpenLayers.Layer.TMS("Dota 2 Map",["http://map1.devilesk.com/dota2/apps/interactivemap2/tiles/","http://map2.devilesk.com/dota2/apps/interactivemap2/tiles/"],{type:"png",getURL:_});t.addLayer(r);t.zoomToMaxExtent();var i=new OpenLayers.Control.LayerSwitcher({ascending:false});t.addControl(i);i.maximizeControl();var s=new OpenLayers.Layer.Vector("Day Vision Range");t.addLayer(s);var o=new OpenLayers.Layer.Vector("Night Vision Range");t.addLayer(o);var u=new OpenLayers.Layer.Vector("True Sight Range");t.addLayer(u);var a=new OpenLayers.Layer.Vector("Attack Range");t.addLayer(a);var f=new OpenLayers.Layer.Vector("Drawn Circles");t.addLayer(f);var l=new OpenLayers.Layer.Vector("Ward Vision");t.addLayer(l);var c=new OpenLayers.Layer.Markers("Placed Wards");t.addLayer(c);polyOptions={sides:30};OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick,dblclick:this.onDblclick},this.handlerOptions)},onClick:y,onDblclick:function(e){var t=document.getElementById(this.key+"Output");var n="dblclick "+e.xy;t.value=t.value+n+"\n"}});var h=OpenLayers.Util.getParameters(window.location.href).renderer;h=h?[h]:OpenLayers.Layer.Vector.prototype.renderers;drawControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:true,immediate:true,handlerOptions:{layerOptions:{renderers:h}}}),circle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:true,immediate:true,handlerOptions:{layerOptions:{renderers:h}}}),observerclick:new OpenLayers.Control.Click({onClick:m,handlerOptions:{single:true}}),sentryclick:new OpenLayers.Control.Click({onClick:g,handlerOptions:{single:true}}),polygonControl:new OpenLayers.Control.DrawFeature(f,OpenLayers.Handler.RegularPolygon,{handlerOptions:polyOptions}),select:new OpenLayers.Control.SelectFeature(f,{hover:true,highlightOnly:false,callbacks:{click:function(e){var t=document.getElementById("output");t.innerHTML="";f.removeFeatures(e)}},overFeature:function(e){var t=document.getElementById("output");var n="radius: "+(.565352*Math.sqrt(e.geometry.getArea())*3.21407509338).toFixed(0)+" units";t.innerHTML=n;this.highlight(e)},outFeature:function(e){var t=document.getElementById("output");t.innerHTML="";this.unhighlight(e)}})};for(var p in drawControls){if(p=="line"){drawControls[p].events.on({measure:b,measurepartial:b})}if(p=="circle"){drawControls[p].events.on({measure:w,measurepartial:E})}t.addControl(drawControls[p])}t.events.register("mousemove",t,function(e){var n=this.events.getMousePosition(e),r=t.getLonLatFromPixel(e.xy),i=d(r.lon,5120-r.lat);n.x=i[0].toFixed(0);n.y=i[1].toFixed(0);OpenLayers.Util.getElement("coords").innerHTML=n});toggleControl=function(e){for(p in drawControls){var t=drawControls[p];if(e.value==p&&e.checked){t.activate()}else{t.deactivate()}if((e.value=="polygonControl"||e.value=="circle")&&e.checked){drawControls["select"].activate()}else{drawControls["select"].deactivate()}}var e=document.getElementById("output");e.innerHTML=""};var S=new OpenLayers.Size(21,25);var x=new OpenLayers.Pixel(-(S.w/2),-S.h);var T=new OpenLayers.Icon("http://www.openlayers.org/dev/img/marker.png",S,x);var N=function(e){return e/(8150- -8200)*5087};var C=function(e){console.log(e);console.log(f);if(!e.object.showinfo){var t=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),N(e.object.day_vision_radius),30);var n=new OpenLayers.Feature.Vector(t);s.addFeatures(n);e.object.day_vision_feature=n;var r={strokeColor:"#007FFF",strokeOpacity:1,strokeWidth:1,fillColor:"#007FFF",fillOpacity:.4};var t=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),N(e.object.true_sight_radius),30);var n=new OpenLayers.Feature.Vector(t,null,r);u.addFeatures(n);e.object.true_sight_feature=n;var t=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),N(e.object.night_vision_radius),30);var n=new OpenLayers.Feature.Vector(t);console.log(n);o.addFeatures(n);e.object.night_vision_feature=n;var r={strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:1,fillColor:"#FF0000",fillOpacity:.4};var t=OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.object.lonlat.lon,e.object.lonlat.lat),N(e.object.attack_range_radius),30);var n=new OpenLayers.Feature.Vector(t,null,r);a.addFeatures(n);e.object.attack_range_feature=n}else{s.removeFeatures(e.object.day_vision_feature);o.removeFeatures(e.object.night_vision_feature);u.removeFeatures(e.object.true_sight_feature);a.removeFeatures(e.object.attack_range_feature)}e.object.showinfo=!e.object.showinfo};$.getJSON("data.json",function(r){console.log(r);var i={};for(var s in r){if(s!="trigger_multiple"&&s!="ent_dota_tree"){i[s]=new OpenLayers.Layer.Markers(n[s]);t.addLayer(i[s]);i[s].setVisibility(false);for(var o=0;o<r[s].length;o++){e=r[s][o];var u=OpenLayers.Popup.FramedCloud;var a="Click to toggle range overlay";var f=k(i[s],new OpenLayers.LonLat(e[0],5120-e[1]),u,a,false);f.day_vision_radius=1800;f.night_vision_radius=800;f.true_sight_radius=900;f.attack_range_radius=700;f.showInfo=false;if(s=="npc_dota_tower"){f.events.register("mousedown",i[s],C)}}}if(s=="ent_dota_tree"){i[s]=new OpenLayers.Layer.Markers(n[s]);t.addLayer(i[s]);i[s].setVisibility(false);i[s].data=r[s]}if(s=="trigger_multiple"){i["npc_dota_neutral_spawner_box"]=new OpenLayers.Layer.Vector(n[s]);t.addLayer(i["npc_dota_neutral_spawner_box"]);i["npc_dota_neutral_spawner_box"].setVisibility(false);for(var o=0;o<r[s].length;o++){e=r[s][o];var l={strokeColor:"#00FF00",strokeOpacity:1,strokeWidth:1,fillColor:"#00FF00",fillOpacity:.4};var c=[];for(var h=0;h<e.length;h++){c.push(new OpenLayers.Geometry.Point(e[h][0],5120-e[h][1]))}var p=new OpenLayers.Geometry.LinearRing(c);var d=new OpenLayers.Feature.Vector(p,null,l);i["npc_dota_neutral_spawner_box"].addFeatures([d])}}}var v=t.getLayersByName("Placed Wards")[0];t.raiseLayer(v,t.layers.length);console.log(t.layers);t.events.register("changelayer",null,function(t){if(t.property==="visibility"&&t.layer.name==n["ent_dota_tree"]&&!t.layer.loaded){for(var r=0;r<t.layer.data.length;r++){e=t.layer.data[r];var i=OpenLayers.Popup.FramedCloud;var s="Tower";var o=k(t.layer,new OpenLayers.LonLat(e[0],5120-e[1]),i,s,false)}t.layer.loaded=!t.layer.loaded}})});var L=5087,A=4916,O=[-8200,8150],M=[8239,-7639];var N=function(e){return e/(O[1]-O[0])*L}})
