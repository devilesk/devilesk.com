ko.bindingHandlers.spinner={init:function(t,e,i,s){var a=i().spinnerOptions||{};$(t).spinner(a),ko.utils.registerEventHandler(t,"spinstart",function(t,i){if(s.cards.state="spinning",s.cards.saveSelectedState(),null!=i.value){var a=e();a(i.value)}}),ko.utils.registerEventHandler(t,"spin",function(t,i){if(null!=i.value){var s=e();s(i.value)}}),ko.utils.registerEventHandler(t,"spinchange",function(){if(null!=$(t).spinner("value")){var i=e();i($(t).spinner("value"))}}),ko.utils.registerEventHandler(t,"spinstop",function(t,i){if("spinning"==s.cards.state&&(s.cards.state=null),null!=i.value){var a=e();a(i.value)}}),ko.utils.domNodeDisposal.addDisposeCallback(t,function(){$(t).spinner("destroy")})},update:function(t,e){var i=ko.utils.unwrapObservable(e()),s=$(t).spinner("value");i!==s&&$(t).spinner("value",i)}},ko.extenders.numeric=function(t,e){var i=ko.pureComputed({read:t,write:function(i){var s=t(),a=Math.pow(10,e),o=isNaN(i)?0:parseFloat(+i),n=Math.round(o*a)/a;n!==s?t(n):i!==s&&t.notifySubscribers(n)}}).extend({notify:"always"});return i(t()),i},function(){function t(t,e,i,s,a,o,n,h){var r=this;this.collection=t,this.selected=ko.observable(!1),this.selected.subscribe(function(t){t?r.$imgDraggable.addClass("ui-state-highlight"):r.$imgDraggable.removeClass("ui-state-highlight"),r.collection.updateSelected()}),this.name=e.replace("npc_dota_hero_",""),this.displayname=i,this.HeroID=s,this.width=this.collection.cardWidth(),this.height=this.collection.cardHeight(),this.x=ko.observable(a-n*this.width/2+this.width/2||0),this.y=ko.observable(o-n*this.height/2+this.height/2||0),this.defaultScale=1,this.scale=ko.observable(n||this.defaultScale),this.scaleStart=0,this.dragStartPos={top:0,left:0},this.zpos=ko.observable(h||100),this.zpos.subscribe(function(t){r.$imgDraggable.css("zIndex",t)});var l="/media/images/heroes/selection/npc_dota_hero_"+this.name+".png";this.snapped=ko.observable(!1),this.snapped.subscribe(function(t){t?(r.setGrid([r.collection.gridWidth(),r.collection.gridHeight()]),r.$img.addClass("card-snapped")):(r.setGrid(!1),r.$img.removeClass("card-snapped"))}),this.$imgDraggable=$("<div>").addClass("card").css("zIndex",this.zpos()).css("position","absolute").width(this.width*this.scale()).height(this.height*this.scale()).draggable({containment:"#container",grid:!1,start:function(t,e){r.collection.state="dragging",r.selected(!0),r.dragStartPos.top=e.position.top,r.dragStartPos.left=e.position.left;var i=[];$(".ui-state-highlight").each(function(t){this!=r.$imgDraggable[0]&&(this.card.dragStartPos.top=parseFloat($(this).css("top"))||0,this.card.dragStartPos.left=parseFloat($(this).css("left"))||0),i.push(this.card.getState())}),r.collection.future.length=0,r.collection.history.push(i),r.collection.historyCount(r.collection.history.length)},drag:function(t,e){$(".ui-state-highlight").each(function(t){this!=r.$imgDraggable[0]&&$(this).css({top:this.card.dragStartPos.top+(e.position.top-r.dragStartPos.top),left:this.card.dragStartPos.left+(e.position.left-r.dragStartPos.left)})})},stop:function(t,e){r.disableSetXY=!0,r.x($(this).position().left-r.collection.$grid.offset().left),r.y($(this).position().top-r.collection.$grid.offset().top),r.disableSetXY=!1,r.setXY(),$(".ui-state-highlight").each(function(t){this!=r.$imgDraggable[0]&&(this.card.x($(this).position().left-this.card.collection.$grid.offset().left),this.card.y($(this).position().top-this.card.collection.$grid.offset().top))}),"dragging"==r.collection.state&&(r.collection.state=null)}}).mousedown(function(t){r.collection.state="clicking",r.selected()?r.selected(!1):(t.shiftKey||t.ctrlKey||r.collection.swap()||r.collection.selectAll(!1),r.selected(!0)),t.stopPropagation(),"clicking"==r.collection.state&&(r.collection.state=null)}),this.$imgResizable=$("<div>").addClass("card-resize").width(this.width*this.scale()).height(this.height*this.scale()).resizable({aspectRatio:!0,handles:"se",start:function(t,e){r.collection.state="resizing",r.selected(!0);var i=[];$(".ui-state-highlight .card-resize").each(function(t){this!=r.$imgResizable[0]&&(this.card.scaleStart=this.card.scale()),i.push(this.card.getState())}),r.collection.future.length=0,r.collection.history.push(i),r.collection.historyCount(r.collection.history.length)},resize:function(t,e){r.$imgDraggable.width(r.width*(r.$imgResizable.width()/r.width)).height(r.height*(r.$imgResizable.width()/r.width)),$(".ui-state-highlight .card-resize").each(function(t){this!=r.$imgResizable[0]&&(this.card.scale(this.card.scaleStart*(r.$imgResizable.width()/r.width)/r.scale()),this.card.resize())})},stop:function(t,e){r.scale(r.$imgResizable.width()/r.width),r.resize(),"resizing"==r.collection.state&&(r.collection.state=null)}}),this.$img=$("<img>").addClass("card-image").attr("src",l).width("100%").height("100%"),this.$imgDraggable[0].card=r,this.$imgResizable[0].card=r,this.$imgDraggable.append(this.$imgResizable),this.$imgResizable.append(this.$img),this.disableSetXY=!1,this.setXY()}function e(t,e,i,a,o,n,h,r){var c=this;this.cardWidth=ko.observable(h),this.cardHeight=ko.observable(r),this.layoutWidth=ko.observable(i),this.layoutHeight=ko.observable(a),this.width=ko.observable(t),this.height=ko.observable(e),this.ratioX=ko.computed(function(){return c.width()/c.layoutWidth()}),this.ratioY=ko.computed(function(){return c.height()/c.layoutHeight()}),this.gridWidth=ko.observable(o||25).extend({numeric:0}),this.gridHeight=ko.observable(n||25).extend({numeric:0}),this.$grid=$("#container").css("zIndex",-100).width(this.width()).height(this.height()),this.aspectRatio=ko.observable("16x9"),this.aspectRatio.subscribe(function(t){c.changeAspectRatio.apply(c,l[t])}),$(document).keydown(function(t){if(!$(".controls input[type=text]").is(":focus"))if(t.ctrlKey)switch(t.which){case 65:c.selectAll(!0)}else switch(t.which){case 74:c.decreaseDepth();break;case 75:c.increaseDepth();break;case 82:c.resetSelected();break;case 84:c.gridShow(!c.gridShow());break;case 71:c.swap(!c.swap());break;case 65:c.nudgeSelected(-1,0);break;case 83:c.nudgeSelected(0,1);break;case 68:c.nudgeSelected(1,0);break;case 87:c.nudgeSelected(0,-1);break;case 86:c.nudgeScaleSelected(-.1);break;case 67:c.nudgeScaleSelected(.1);break;case 66:c.swapSelection();break;case 70:c.selection().length>0&&(c.selection()[0].snapped()?c.unsnapSelection():c.snapSelection());break;case 69:""!=c.downloadLink&&$("#download-link").fadeOut().fadeIn(),c.downloadLink(s(c.toLayoutVMF()));break;case 81:""!=c.shareId&&$("#share-link").fadeOut().fadeIn(),c.share();break;case 90:c.undo();break;case 88:c.redo()}}),this.$ghostSelect=$('<div class="ghost-select"><span></span></div>'),this.$grid.append(this.$ghostSelect),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.width(),this.canvas.height=this.height(),this.ctx=this.canvas.getContext("2d"),this.$grid.append(this.canvas),this.sizeChanged=ko.computed(function(){c.canvas.width=c.width(),c.canvas.height=c.height(),c.$grid.width(c.width()).height(c.height()),c.drawGridLines()}),this.gridShow=ko.observable(!0),this.gridShow.subscribe(function(t){t?c.drawGridLines():c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height)}),this.gridChangeEmitter=ko.observable(0),this.gridListener=ko.computed(function(){c.gridWidth(),c.gridHeight(),c.gridChangeEmitter((c.gridChangeEmitter()+1)%10)}),this.gridChangeEmitter.subscribe(function(t){if(!c.modifyingState){var e=[];e.gridWidth=c.gridWidth(),e.gridHeight=c.gridHeight(),c.snapped().map(function(t){e.push(t.getState()),t.setGrid([c.gridWidth(),c.gridHeight()]),t.snap()}),c.future.length=0,c.history.push(e),c.historyCount(c.history.length)}}),this.swap=ko.observable(!1),this.swap.subscribe(function(t){t&&c.selectAll(!1),c.draggable(!t),c.resizable(!t)}),this.historyCount=ko.observable(0),this.selectedCount=ko.observable(0),this.selectedCard=ko.observable(null),this.downloadLink=ko.observable(""),this.shareId=ko.observable(""),this.history=[],this.future=[],this.modifyingState=!1,this.state=null,this.search=ko.observable(""),this.search.subscribe(function(t){return c.state="selecting",c.disableUpdateSelected=!0,t?(c.map(function(e){0==e.name.toLowerCase().indexOf(t.toLowerCase())||0==e.displayname.toLowerCase().indexOf(t.toLowerCase())?e.selected(!0):e.selected(!1)}),c.disableUpdateSelected=!1,c.updateSelected(),void((c.state="selecting")&&(c.state=null))):void c.selectAll(!1)})}function i(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function s(t){var e=new Blob([t],{type:"text/plain"});return null!==d&&window.URL.revokeObjectURL(d),d=window.URL.createObjectURL(e)}function a(t,e){var i=t.target.files[0];if(i){var s=new FileReader;s.onload=function(t){var s=t.target.result;document.getElementById("upload-file").value=i.name,e(s)},s.readAsText(i)}else alert("Failed to load file")}function o(t){var e=this;e.width=t.width,e.height=t.height,e.gridWidth=t.gridWidth,e.gridHeight=t.gridHeight,e.gridShow=t.gridShow,e.aspectRatio=t.aspectRatio,e.swap=t.swap,e.snapSelection=t.snapSelection.bind(t),e.unsnapSelection=t.unsnapSelection.bind(t),e.swapSelection=t.swapSelection.bind(t),e.undo=t.undo.bind(t),e.redo=t.redo.bind(t),e.clearHistory=t.clearHistory.bind(t),e.historyCount=t.historyCount,e.cards=t,e.search=t.search,e.selectedCount=t.selectedCount,e.selectedCard=t.selectedCard,e.selectedCardX=ko.computed({read:function(){return e.cards.selectedCount()>1?"n/a":null!=e.selectedCard()?e.selectedCard().x():null},write:function(t){e.cards.selectedCount()>0&&e.cards.setSelectedProperty("x",parseFloat(t))},owner:this}),e.selectedCardY=ko.computed({read:function(){return e.cards.selectedCount()>1?"n/a":null!=e.selectedCard()?e.selectedCard().y():null},write:function(t){e.cards.selectedCount()>0&&e.cards.setSelectedProperty("y",parseFloat(t))},owner:this}),e.selectedCardZPos=ko.pureComputed({read:function(){return e.cards.selectedCount()>1?"n/a":null!=e.selectedCard()?e.selectedCard().zpos():null},write:function(t){e.cards.selectedCount()>0&&e.cards.setSelectedProperty("zpos",parseFloat(t))},owner:this}),e.selectedCardScale=ko.pureComputed({read:function(){return e.cards.selectedCount()>1?"n/a":null!=e.selectedCard()?e.selectedCard().scale():null},write:function(t){e.cards.selectedCount()>0&&e.cards.setSelectedProperty("scale",parseFloat(t))},owner:this}),e.backgroundImage=ko.computed(function(){return"url(img/background_"+t.aspectRatio()+".jpg)"}),e.marginLeft=ko.computed(function(){return l[t.aspectRatio()][8]+"px"}),e.backgroundWidth=ko.computed(function(){return l[t.aspectRatio()][9]+"px"}),e.backgroundWidth2=ko.computed(function(){return l[t.aspectRatio()][9]-10+"px"}),e.reset=t.resetSelected.bind(t),e.downloadLink=t.downloadLink,e.shareId=t.shareId,e.shareLink=ko.computed(function(){return[location.protocol,"//",location.host,location.pathname].join("")+"?id="+e.shareId()}),e.shareLayout=function(){""!=t.shareId&&$("#share-link").fadeOut().fadeIn(),t.share()},e.exportLayout=function(){""!=t.downloadLink&&$("#download-link").fadeOut().fadeIn(),t.downloadLink(s(t.toLayoutVMF()))},e.importLayout=function(e){t.parseVMF(e)},document.getElementById("import-layout").addEventListener("change",function(t){a(t,e.importLayout)},!1)}function n(t){$(document).unbind("mousemove",h),$(document).unbind("mouseup",n);new Array;c.state="selecting",c.disableUpdateSelected=!0,$(".card").each(function(){var t=$(".ghost-select"),e=$(this),i=r(t,e);1==i&&this.card.selected(!0)}),c.disableUpdateSelected=!1,c.updateSelected(),(c.state="selecting")&&(c.state=null),$(".ghost-select").removeClass("ghost-active"),$(".ghost-select").width(0).height(0)}function h(t){var e=Math.abs(initialW-t.pageX),i=Math.abs(initialH-t.pageY);initialW+e>$(document).width()&&t.pageX>initialW||initialH+i>$(document).height()&&t.pageY>initialH||($(".ghost-select").css({width:e,height:i}),t.pageX<=initialW&&t.pageY>=initialH?$(".ghost-select").css({left:t.pageX}):t.pageY<=initialH&&t.pageX>=initialW?$(".ghost-select").css({top:t.pageY}):t.pageY<initialH&&t.pageX<initialW&&$(".ghost-select").css({left:t.pageX,top:t.pageY}))}function r(t,e){var i=t.offset().top,s=t.offset().left,a=e.offset().top,o=e.offset().left;return!(i+t.height()<a||i>a+e.height()||s+t.width()<o||s>o+e.width())}t.prototype.getState=function(){return{HeroID:this.HeroID,x:this.x(),y:this.y(),scale:this.scale(),zpos:this.zpos(),grid:this.$imgDraggable.draggable("option","grid"),snapped:this.snapped(),selected:this.selected()}},t.prototype.loadState=function(t){this.snapped(t.snapped),this.x(t.x),this.y(t.y),this.scale(t.scale),this.zpos(t.zpos),this.$imgDraggable.draggable("option","grid",t.grid),this.selected(t.selected),this.setXY(),this.resize()},t.prototype.getX=function(){return(this.x()+this.$imgDraggable.width()/2-this.width/2)/this.collection.ratioX()},t.prototype.getY=function(){return(this.y()+this.$imgDraggable.height()/2-this.height/2)/this.collection.ratioY()},t.prototype.draggable=function(t){this.$imgDraggable.draggable(t?"enable":"disable")},t.prototype.resizable=function(t){this.$imgResizable.resizable(t?"enable":"disable")},t.prototype.destroy=function(){this.$imgDraggable.remove(),this.$imgResizable.remove(),this.$img.remove()},t.prototype.setXY=function(){this.disableSetXY||this.$imgDraggable.css({top:this.collection.$grid.offset().top+this.y(),left:this.collection.$grid.offset().left+this.x()})},t.prototype.setGrid=function(t){this.$imgDraggable.draggable("option","grid",t)},t.prototype.resize=function(){this.$imgDraggable.width(this.width*this.scale()).height(this.height*this.scale()),this.$imgResizable.width(this.width*this.scale()).height(this.height*this.scale())},t.prototype.reset=function(){this.scale(this.defaultScale),this.resize()},t.prototype.snap=function(){this.x()%this.collection.gridWidth()<this.collection.gridWidth()/2?this.x(this.x()-this.x()%this.collection.gridWidth()):this.x(this.x()+this.collection.gridWidth()-this.x()%this.collection.gridWidth()),this.y()%this.collection.gridHeight()<this.collection.gridHeight()/2?this.y(this.y()-this.y()%this.collection.gridHeight()):this.y(this.y()+this.collection.gridHeight()-this.y()%this.collection.gridHeight()),this.setXY()},e.prototype=Object.create(Array.prototype),e.prototype.constructor=e,e.prototype.empty=function(){for(;this.length>0;){var t=this.pop();t.destroy()}},e.prototype.changeAspectRatio=function(t,e,s,a,o,n,h,r){var l=this;this.cardWidth(h),this.cardHeight(r),this.layoutWidth(s),this.layoutHeight(a),this.width(t),this.height(e),this.gridWidth(o),this.gridHeight(n);var c=i("id");c?$.get("save/"+c+".txt",function(t){l.parseVMF(t)}):$.get("default_"+this.aspectRatio()+".txt",function(t){l.parseVMF(t)})},e.prototype.getHeroID=function(t){for(var e=0;e<this.length;e++)if(this[e].HeroID==t)return this[e];return null},e.prototype.getName=function(t){for(var e=t.replace("npc_dota_hero_",""),i=0;i<this.length;i++)if(this[i].name==e)return this[i];return null},e.prototype.drawGridLines=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineWidth=1,this.ctx.strokeStyle="#ff0000",this.ctx.stroke();for(var t=0;t<=Math.floor(this.canvas.width/this.gridWidth());t++)this.ctx.beginPath(),this.ctx.moveTo(t*this.gridWidth(),0),this.ctx.lineTo(t*this.gridWidth(),this.canvas.height),this.ctx.strokeStyle="#000000",this.ctx.stroke();for(var t=0;t<=Math.floor(this.canvas.height/this.gridHeight());t++)this.ctx.beginPath(),this.ctx.moveTo(0,t*this.gridHeight()),this.ctx.lineTo(this.canvas.width,t*this.gridHeight()),this.ctx.strokeStyle="#000000",this.ctx.stroke()},e.prototype.setGrid=function(t){this.snapped().map(function(e){e.setGrid(t)})},e.prototype.undo=function(){if(this.history.length>0){this.state="undoing",this.modifyingState=!0,this.swap(!1);var t=this.history.pop(),e=[];e.gridWidth=this.gridWidth(),e.gridHeight=this.gridHeight(),void 0!=t.gridWidth&&this.gridWidth(t.gridWidth),void 0!=t.gridHeight&&this.gridHeight(t.gridHeight);for(var i=0;i<t.length;i++){var s=this.getHeroID(t[i].HeroID);e.push(s.getState()),s.loadState(t[i])}this.future.push(e),this.modifyingState=!1,"undoing"==this.state&&(this.state=null)}},e.prototype.redo=function(){if(this.future.length>0){this.state="redoing",this.modifyingState=!0,this.swap(!1);var t=this.future.pop(),e=[];e.gridWidth=this.gridWidth(),e.gridHeight=this.gridHeight(),void 0!=t.gridWidth&&this.gridWidth(t.gridWidth),void 0!=t.gridHeight&&this.gridHeight(t.gridHeight);for(var i=0;i<t.length;i++){var s=this.getHeroID(t[i].HeroID);e.push(s.getState()),s.loadState(t[i])}this.history.push(e),this.modifyingState=!1,"redoing"==this.state&&(this.state=null)}},e.prototype.clearHistory=function(){this.history.length=0,this.future.length=0,this.historyCount(0)},e.prototype.applyAction=function(t,e,i){this.state=e;var s=[];t.map(function(t){s.push(t.getState()),i(t)}),this.future.length=0,s.length>0&&this.history.push(s),this.historyCount(this.history.length),this.state==e&&(this.state=null)},e.prototype.increaseDepth=function(){this.applyAction(this.selection(),"increasingDepth",function(t){t.zpos(t.zpos()+1)})},e.prototype.decreaseDepth=function(){this.applyAction(this.selection(),"decreasingDepth",function(t){t.zpos(t.zpos()-1)})},e.prototype.nudgeSelected=function(t,e){var i=this;this.applyAction(this.selection(),"nudging",function(s){0!=t&&s.x(s.x()+t*(s.snapped()?i.gridWidth():1)),0!=e&&s.y(s.y()+e*(s.snapped()?i.gridHeight():1)),s.setXY()})},e.prototype.nudgeScaleSelected=function(t){this.applyAction(this.selection(),"nudgingScale",function(e){e.scale(e.scale()+t),e.resize()})},e.prototype.resetSelected=function(){this.applyAction(this.selection(),"resetting",function(t){t.reset()})},e.prototype.selectAll=function(t){this.disableUpdateSelected=!0,this.map(function(e){e.selected(t)}),t||this.search(""),this.selectedCount(t?this.length:0),this.selectedCard(null),this.disableUpdateSelected=!1},e.prototype.selection=function(){return this.filter(function(t){return t.selected()})},e.prototype.snapped=function(){return this.filter(function(t){return t.snapped()})},e.prototype.swapSelection=function(){if(2==this.selectedCount()){for(var t=-1,e=-1,i=0;i<this.length;i++)this[i].selected()&&(t==-1?t=i:e==-1&&(e=i));this.doSwap(t,e)}},e.prototype.snapSelection=function(){this.applyAction(this.selection(),"snapping",function(t){t.snapped(!0),t.snap()})},e.prototype.unsnapSelection=function(){this.applyAction(this.selection(),"unsnapping",function(t){t.snapped(!1)})},e.prototype.setSelectedProperty=function(t,e){this.selection().map(function(i){i[t](e),"x"!=t&&"y"!=t||i.setXY(),"scale"==t&&i.resize()})},e.prototype.draggable=function(t){this.map(function(e){e.draggable(t)})},e.prototype.resizable=function(t){this.map(function(e){e.resizable(t)})},e.prototype.parseVMF=function(t){var e=Object.keys(g);this.empty();for(var i=t.split("\n").map(function(t){return t.trim(" \t")}),s=0,a=0;a<i.length;a++){var o,n,h,r,c,d,p;"{"==i[a]?s++:"}"==i[a]?(s--,1==s&&(this.add(o,n,h,r,c,d,p),e.splice(e.indexOf(h.toString()),1))):2==s&&(i[a].indexOf('"HeroID"')>-1?(h=parseFloat(i[a].replace("HeroID","").replace(/"/g,"")),o=g[h].name,n=g[h].displayname):i[a].indexOf('"x"')>-1?r=(parseFloat(i[a].replace("x","").replace(/"/g,""))-l[this.aspectRatio()][10])*this.ratioX():i[a].indexOf('"y"')>-1?c=parseFloat(i[a].replace("y","").replace(/"/g,""))*this.ratioY():i[a].indexOf('"scale"')>-1?d=parseFloat(i[a].replace("scale","").replace(/"/g,""))/l[this.aspectRatio()][11]:i[a].indexOf('"zpos"')>-1&&(p=parseFloat(i[a].replace("zpos","").replace(/"/g,""))))}for(var a=0;a<e.length;a++){var u=g[e[a]];this.add(u.name,u.displayname,u.HeroID)}this.future.length=0,this.history.length=0,this.historyCount(0)},e.prototype.toLayoutVMF=function(){var t='"fulldeck_layout.txt"\n';t+="{\n";for(var e=0;e<this.length;e++)t+='\t\t"'+e+'"\n',t+="\t\t{\n",t+='\t\t\t\t"HeroID"\t\t\t\t"'+this[e].HeroID+'"\n',t+='\t\t\t\t"x"\t\t\t\t"'+(this[e].getX()+l[this.aspectRatio()][10])+'"\n',t+='\t\t\t\t"y"\t\t\t\t"'+this[e].getY()+'"\n',t+='\t\t\t\t"scale"\t\t\t\t"'+this[e].scale()*l[this.aspectRatio()][11]+'"\n',t+='\t\t\t\t"zpos"\t\t\t\t"'+this[e].zpos()+'"\n',t+="\t\t}\n";return t+="}\n"},e.prototype.add=function(e,i,s,a,o,n,h){var r=new t(this,e,i,s,a,o,n,h);this.push(r),this.$grid.append(r.$imgDraggable)},e.prototype.doSwap=function(t,e){var i=[];i.push(this[t].getState()),i.push(this[e].getState()),this.future.length=0,this.history.push(i),this.historyCount(this.history.length);var s={x:this[t].x(),y:this[t].y()};this[t].x(this[e].x()),this[t].y(this[e].y()),this[t].setXY(),this[e].x(s.x),this[e].y(s.y),this[e].setXY()},e.prototype.saveSelectedState=function(){var t=[];t.gridWidth=this.gridWidth(),t.gridHeight=this.gridHeight(),this.selection().map(function(e){t.push(e.getState())}),this.future.length=0,this.history.push(t),this.historyCount(this.history.length)},e.prototype.disableUpdateSelected=!1,e.prototype.updateSelected=function(){if(!this.disableUpdateSelected){for(var t=-1,e=-1,i=0,s=0;s<this.length;s++)this[s].selected()&&(i++,t==-1?t=s:e==-1&&(e=s));this.selectedCount(i),this.swap()&&2==this.selectedCount()&&!this.modifyingState&&(this.doSwap(t,e),this.selectAll(!1)),1==this.selectedCount()?this.selectedCard(this[t]):this.selectedCard(null)}},e.prototype.share=function(){var t=this;$.ajax({type:"POST",url:"save.php",data:{data:t.toLayoutVMF()},dataType:"json",success:function(e){e.error?alert("Save request failed."):t.shareId(e.file)},failure:function(t){alert("Save request failed.")}})};var l={"16x10":[1560,600,1158,440,70,70,66,66,120,1680,0,.390228],"16x9":[1700,618,1208,440,72,72,68,68,220,1920,0,.390228],"4x3":[1280,548,1034,450,58,58,54,54,0,1280,10,.34848]},c=new e(1700,618,1208,440,72,72,68,68),d=null,g={};$.getJSON("/media/dota-json/herodata.json",function(t){for(key in t){var e=t[key];g[e.HeroID]=e,c.add(key,e.displayname,e.HeroID)}var s=new o(c);ko.applyBindings(s);var a=i("id");a?$.get("save/"+a+".txt",function(t){c.parseVMF(t),i("canvas_only")&&($(".controls-wrapper").remove(),$("#instructions").remove(),c.gridShow(!1))}):$.get("default_"+c.aspectRatio()+".txt",function(t){c.parseVMF(t),i("canvas_only")&&($(".controls-wrapper").remove(),$("#instructions").remove(),c.gridShow(!1))})}),$("#selection-area").mousedown(function(t){c.swap()||(t.shiftKey||t.ctrlKey||c.selectAll(!1),$("#big-ghost").remove(),$(".ghost-select").addClass("ghost-active"),$(".ghost-select").css({left:t.pageX,top:t.pageY}),initialW=t.pageX,initialH=t.pageY,$(document).bind("mouseup",n),$(document).bind("mousemove",h))}),$(window).bind("mousewheel DOMMouseScroll",function(t){c.selectedCount()>0&&(t.originalEvent.wheelDelta>0||t.originalEvent.detail<0?c.nudgeScaleSelected(.1):c.nudgeScaleSelected(-.1),t.preventDefault())})}();