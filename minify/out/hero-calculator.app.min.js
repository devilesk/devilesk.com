var HEROCALCULATOR=function(a){ko.bindingHandlers.jqAuto={init:function(f,j,d,m){var o=j()||{},i=d(),g=ko.utils.unwrapObservable,c=i.jqAutoValue,b=i.jqAutoSource,l=i.jqAutoSourceValue,k=i.jqAutoSourceInputValue||l,e=i.jqAutoSourceLabel||l;function h(p){if(ko.isWriteableObservable(c)){c(p)}else{if(i._ko_property_writers&&i._ko_property_writers["jqAutoValue"]){i._ko_property_writers["jqAutoValue"](p)}}}o.select=function(p,q){h(q.item?q.item.actualValue:null)};o.change=function(q,s){var p=$(f).val();var r=ko.utils.arrayFirst(g(b),function(t){return g(t[k])===p});if(!r){h(null)}};var n=ko.dependentObservable(function(){mapped=ko.utils.arrayMap(g(b),function(q){var p={};p.label=e?g(q[e]):g(q).toString();p.value=k?g(q[k]):g(q).toString();p.actualValue=l?g(q[l]):q;return p});return mapped});n.subscribe(function(p){$(f).autocomplete("option","source",p)});o.source=n();$(f).autocomplete(o)},update:function(e,h,d,k){var g=d(),f=ko.utils.unwrapObservable,c=f(g.jqAutoValue)||"",j=g.jqAutoSourceValue,i=g.jqAutoSourceInputValue||j;if(j&&i!==j){var b=f(g.jqAutoSource)||[];var c=ko.utils.arrayFirst(b,function(l){return f(l[j])===c})||{}}$(e).val(c&&i!==j?f(c[i]):c.toString())}};ko.bindingHandlers.jqAutoCombo={init:function(b,c){var d=$("#"+c());$(b).click(function(){if(d.autocomplete("widget").is(":visible")){d.autocomplete("close");return}d.autocomplete("search"," ");d.focus()})}};a.HeroCalculatorViewModel=function(){var b=this;b.heroes=[new a.HeroCalculatorModel(1),new a.HeroCalculatorModel(0)];b.heroes[0].enemy=ko.observable(b.heroes[1]);b.heroes[1].enemy=ko.observable(b.heroes[0]);b.heroes[0].unit=ko.observable(new a.UnitViewModel(0,b.heroes[0]));b.heroes[1].unit=ko.observable(new a.UnitViewModel(0,b.heroes[1]));b.heroes[0].unit().selectedUnit(b.heroes[0].unit().availableUnits()[0]);b.heroes[1].unit().selectedUnit(b.heroes[1].unit().availableUnits()[0]);b.heroes[0].selectedHero(b.heroes[0].availableHeroes()[0]);b.heroes[1].selectedHero(b.heroes[1].availableHeroes()[1]);b.heroes.push(b.heroes[0].unit());b.heroes.push(b.heroes[1].unit());b.selectedTab=ko.observable(0);b.selectedItem=ko.observable();b.layout=ko.observable(1);b.displayShop=ko.observable(true);b.toggleDisplayShop=function(){b.displayShop(!b.displayShop())};b.allItems=ko.observableArray([{name:"Str,Agi,Int,MS,Turn,Sight",value:"stats0"},{name:"Health,Mana,Regen,EHP",value:"stats1"},{name:"Armor,Magic Res,Lifesteal,Evasion,Bash,Miss",value:"stats2"},{name:"Damage,IAS,BAT,Attack",value:"stats3"}]);b.selectedItems=ko.observableArray([]);b.moveUp=function(){var f=b.allItems.indexOf(b.selectedItems()[0]),c=b.allItems.indexOf(b.selectedItems()[b.selectedItems().length-1]);if(f>0){var d=b.allItems.splice(f-1,1);b.allItems.splice(c,0,d[0])}};b.moveDown=function(){var f=b.allItems.indexOf(b.selectedItems()[0]),c=b.allItems.indexOf(b.selectedItems()[b.selectedItems().length-1]);if(c<b.allItems().length-1){var d=b.allItems.splice(c+1,1);b.allItems.splice(f,0,d[0])}};b.clickTab=function(d,c){if(c.target.id=="heroTab0"){b.selectedTab(0)}else{if(c.target.id=="heroTab1"){b.selectedTab(1)}else{if(c.target.id=="unitTab0"){b.selectedTab(2)}else{if(c.target.id=="unitTab1"){b.selectedTab(3)}}}}};b.changeSelectedItem=function(d,c){b.itemInputValue(1);b.selectedItem(c.target.id)};b.getItemTooltipData=ko.computed(function(){return a.getItemTooltipData(b.selectedItem())},this);b.getItemInputLabel=ko.computed(function(){if(a.stackableitems.indexOf(b.selectedItem())!=-1){return"Stack Size"}else{if(a.levelitems.indexOf(b.selectedItem())!=-1){return"Upgrade Level"}else{if(b.selectedItem()=="bloodstone"){return"Charges"}else{return""}}}},this);b.itemInputValue=ko.observable(1);b.save=function(){console.log("this");console.log(this);console.log("ko.toJS");var e=ko.toJS(this);console.log(e);var c=JSON.stringify(JSON.decycle(e));var d=JSON.retrocycle(JSON.parse(c));console.log("unserialized");console.log(d);console.log("loading");b.load(d);$.ajax({type:"POST",url:"/dota2/apps/hero-calculator/hero-calculator.save.py",data:{data:c},dataType:"json",success:function(g){var f=document.createElement("a");f.href="/dota2/apps/hero-calculator/"+g.data;f.target="_blank";f.innerHTML="devilesk.com/dota2/apps/hero-calculator/"+g.data;document.getElementById("savelink").innerHTML="";document.getElementById("savelink").appendChild(f)},failure:function(f){alert("Save request failed.")}})};b.load=function(e){b.allItems=ko.observableArray(e.allItems);for(var d=0;d<e.heroes.length;d++){b.heroes[d].selectedHero(e.heroes[d].selectedHero);b.heroes[d].selectedHeroLevel(e.heroes[d].selectedHeroLevel);for(var c=0;c<e.heroes[d].ability.abilities.length;c++){b.heroes[d].ability().abilities()[c].level(e.heroes[d].ability.abilities[c].level);console.log("level "+e.heroes[d].ability.abilities[c].level)}}console.log(this)}};a.heroCalculator={};a.init=function(){$.getJSON("/media/js/herodata.json",function(b){a.heroData=b;a.heroData.npc_dota_hero_chen.abilities[2].behavior.push("DOTA_ABILITY_BEHAVIOR_NOT_LEARNABLE");$.getJSON("/media/js/itemdata.json",function(c){a.itemData=c;$.getJSON("/media/js/unitdata.json",function(d){a.unitData=d;console.log(a.unitData);a.heroCalculator=new a.HeroCalculatorViewModel;ko.applyBindings(a.heroCalculator)})})})};return a}(HEROCALCULATOR);