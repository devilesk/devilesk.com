
<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">

    <title>Creating a Dota Map Image</title>
    <meta name="description" content="How I create images of the Dota 2 map.
">
    <meta name="author" content="devilesk">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">

            <link rel="stylesheet" href="/media/bootstrap/css/bootstrap.css">
            <link rel="stylesheet" href="/media/css/blog.css">

    	    </head>
<body id="creating-a-dota-map-image">
    <div class="wrapper">
                    <div class="navbar navbar-default main_nav">
	<div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/dota2"></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="top-nav-menu nav navbar-nav">
			<li class="dropdown ">
                  <a href="/dota2/apps" class="dropdown-toggle" data-toggle="dropdown">WEB APPS <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li class="mobile-only"><a href="/dota2/apps">Web Apps Home</a></li>
                    <li class="divider mobile-only"></li>
                    <li class="dropdown-header">Trivia</li>
                    <li><a href="/dota2/apps/abilitymatching">Ability Matching</a></li>
                                            <li><a href="/dota2/apps/ability-trivia">Ability Trivia</a></li>
                                            <li><a href="/dota2/apps/ability-name-trivia">Ability Name Trivia</a></li>
                                            <li><a href="/dota2/apps/hero-name-trivia">Hero Name Trivia</a></li>
                                            <li><a href="/dota2/apps/item-cost-trivia">Item Cost Trivia</a></li>
                                            <li><a href="/dota2/apps/item-name-trivia">Item Name Trivia</a></li>
                                            <li class="divider"></li><li class="dropdown-header">Maps</li>
                    <li><a href="/dota2/apps/drawablemap">Drawable Map</a></li>
                                            <li><a href="/dota2/apps/interactivemap">Interactive Map</a></li>
                                            <li class="divider"></li><li class="dropdown-header">Other</li>
                    <li><a href="/dota2/apps/hero-calculator">Hero Calculator</a></li>
                                            <li><a href="/dota2/apps/hero-selection-trainer">Hero Selection Trainer</a></li>
                                            <li><a href="/dota2/apps/item-scramble">Item Scramble</a></li>
                                            <li><a href="/dota2/apps/layout-editor">Layout Editor</a></li>
                                            <li><a href="/dota2/apps/replay/viewer">Replay Viewer</a></li>
                                            <li><a href="/dota2/apps/tread-switch-trainer">Tread Switch Trainer</a></li>
                                                              </ul>
                </li>
                <li class="dropdown ">
                  <a href="/dota2/heroes" class="dropdown-toggle" data-toggle="dropdown">HEROES <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li class="mobile-only"><a href="/dota2/heroes">Heroes Home</a></li>
                    <li class="divider mobile-only"></li>
                    <li><a href="/dota2/apps/chart">Stat Chart</a></li>
                                            <li><a href="/dota2/heroes/herodata">Stat Table</a></li>
                                            <li><a href="/dota2/heroes/lore">Lore</a></li>
                                            <li><a href="/dota2/heroes/patchhistory">Patch History</a></li>
                                            <li><a href="/dota2/heroes/unitdata">Unit Stat Table</a></li>
                                                              </ul>
                </li>
                                <li class=""><a href="/dota2/items">ITEMS</a></li><li class="dropdown ">
                  <a href="/dota2/guides" class="dropdown-toggle" data-toggle="dropdown">GUIDES <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li class="mobile-only"><a href="/dota2/guides">Guides Home</a></li>
                    <li class="divider mobile-only"></li>
                    <li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=123364976">Comprehensive Dota 2 Guide</a></li>
                                            <li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=126386524">Basic Advice to Improve Your Games</a></li>
                                            <li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=125563122">Beginner's Guide to Items</a></li>
                                                              </ul>
                </li>
                                <li class="active"><a href="/blog">BLOG</a></li>		  </ul>
		</div>
	</div>
</div>
                
        <div class="container">
<ol class="breadcrumb">
                                                                                                                                            <li class="breadcrumb-item"><a href="/"></a></li>
                                                            <li class="breadcrumb-item"><a href="/blog/">Blog</a></li>
                                <li class="breadcrumb-item active"></li>
            </ol>

</div>
<div class="container">
        <div id="main" role="main">
        <header class="banner clearfix">
                                                </header>
        <section class="content">
            <article class="post">
<nav class="post_nav">
<a class="btn btn-default btn-xs backlink" href="/blog">Back to list</a>
<a class="btn btn-default btn-xs prev disabled"
    title=""
    >
    Newer
</a>

<a class="btn btn-default btn-xs next"
    title="Interactive Map Lane View Update"
        href="/blog/interactive-map-lane-view-update.html">
    Older
</a>
</nav>
<h1 class="title">
    <a href="/blog/creating-a-dota-map-image.html">
        Creating a Dota Map Image
    </a>
</h1>
<time datetime="2016-09-04">
    Posted: Sun, 04 Sep 2016
</time>

<p><img alt="Creating a Dota Map Image" src="/media/images/blog/creating-a-dota-map-image/header.png" />
I figured out how to generate dota 2 map images using Source&nbsp;Filmmaker.</p>
<p>My original method for creating dota map images was stitching together screenshots I took in game. But the <code>cl_leveloverview</code> command I used to get the orthographic projection stopped working ever since the Dota 2 Reborn update. So for a period of time I wasn&#8217;t able to create new map images. Then one day Noxville sent me a map image created by MaxOfS2D which I was able to use in my interactive map. It was a good image and showed me that it was possible to use Source Filmmaker to create dota map images. After the latest map changes made that image outdated, I needed to figure out how to use <span class="caps">SFM</span> to create map images&nbsp;myself.</p>
<p>Dota Workshop Tools comes with <span class="caps">SFM</span>, so I just opened up a new custom game project and launched <span class="caps">SFM</span> from there. This was my first time using <span class="caps">SFM</span> so I had no idea what I was doing. But eventually I ended up with this <span class="caps">SFM</span> session file <a href="/media/blog/creating-a-dota-map-image/dotamap7.dmx">dotamap7.dmx</a></p>
<p>It&#8217;s basically a 45 second long movie with the camera panning over the dota map. It starts in the bottom left corner and ends up in the top right corner moving in a snake-like pattern. The camera distance is set to a very large value and the field of view is set to&nbsp;1.</p>
<p>Here&#8217;s the camera prop values I set in the element&nbsp;viewer.</p>
<p><img alt="Camera X" src="/media/images/blog/creating-a-dota-map-image/camera_props.png" /></p>
<p>Here&#8217;s some views of the Graph Editor timeline which describe the movement of the&nbsp;camera.</p>
<p><img alt="Camera X" src="/media/images/blog/creating-a-dota-map-image/grapheditor_x.png" /></p>
<p>The camera X position goes from -3000 to 10500 over 5 seconds which represents one left to right sweep over the&nbsp;map.</p>
<p><img alt="Camera Y" src="/media/images/blog/creating-a-dota-map-image/grapheditor_y.png" /></p>
<p>The Y position remains constant during this time. Then the X position stays constant for 1 second while the Y position increases. This sets up for the next&nbsp;row.</p>
<p>The X position then moves in the opposite direction from 10500 to -3000 over 5 seconds, which makes a right to left sweep over the map. Then the X position stays constant for another 1 second while the Y position goes up to start another row like before. This pattern is repeated until the whole map is&nbsp;covered.</p>
<p><img alt="Camera XY" src="/media/images/blog/creating-a-dota-map-image/grapheditor_xy.png" /></p>
<p>The Z position and <span class="caps">XYZ</span> rotation are&nbsp;constant.</p>
<p><img alt="Camera Z" src="/media/images/blog/creating-a-dota-map-image/grapheditor_z.png" /></p>
<p><img alt="Camera rotation XYZ" src="/media/images/blog/creating-a-dota-map-image/grapheditor_rot_xyz.png" /></p>
<p>Here&#8217;s an example movie demonstrating the camera&nbsp;movement.</p>
<video src="/media/blog/creating-a-dota-map-image/dotamapsample.webm" width="640" height="360" autoplay controls loop></video>

<p>To get the images necessary to form the dota map image, the movie is exported as pngs with a resolution of 3840x2160 at 1 <span class="caps">FPS</span>. Since the camera movement is set to take 5 seconds for one horizontal pass over the map that results in 5 frames per row. There&#8217;s 9 rows so that&#8217;s 45 images in total which come together in a 5x9 grid to form a complete image of the dota&nbsp;map.</p>
<p>I stitch together the images using Microsoft&#8217;s free <a href="http://research.microsoft.com/en-us/um/redmond/projects/ice/">Image Compositor&nbsp;Editor</a></p>
<p><img alt="Map Stitching" src="/media/images/blog/creating-a-dota-map-image/map_stitching.png" /></p>
<h2>Mapping Image Coordinates to In-game&nbsp;Coordinates</h2>
<p>Now that I have a dota map image, the next step to using it in my interactive map is to figure out how the pixel coordinates map to in-game&nbsp;coordinates.</p>
<p>To do this I start with two in-game coordinates and find the corresponding pixel coordinates on the map image. Then I get the ratio of the X component distance between the two in-game coordinates and the two map pixel coordinates. I do the same thing for the Y component. So now I have two scale factors that I can just multiply map pixel coordinates by to get the corresponding in-game&nbsp;coordinate.</p>
<p>Here&#8217;s a concrete example that I used for this latest&nbsp;map.</p>
<p>The two coordinates I&#8217;m going to use&nbsp;are:</p>
<ul>
<li>map origin&nbsp;(0,0)</li>
<li>Radiant bottom right Tier 4 tower (-5389.603515625,&nbsp;-5216.4809570313)</li>
</ul>
<p>I found the tower coordinate by just loading the map in Hammer and selecting the tower&nbsp;entity.</p>
<p>Then I got the corresponding pixel coordinates by just opening the image in Photoshop and moving my mouse over the right location and reading the x,y in the info&nbsp;window.</p>
<p>So the two coordinates on the map&nbsp;are:</p>
<ul>
<li>map origin (7800,&nbsp;8280)</li>
<li>Radiant bottom right Tier 4 tower (2840,&nbsp;13064)</li>
</ul>
<p>The X distance from origin to tower in-game is |-5389.603515625 - 0| = 5389.603515625 and in pixels it&#8217;s |2840 - 7800| = 4960.
The ingame/image ratio is 5389.603515625/4960 =&nbsp;1.08661361202</p>
<p>For my purposes I need to get what the bounds of the map image are in terms of in-game coordinates. My image is 16384x16384 so I need to figure out what (0,0), (0, 16384), (16384, 0), and (16384, 16384) correspond to in-game. I can do this using the map origin pixel coordinate (7800, 8280) and the scale factor of 5389.603515625/4960 = 1.08661361202 I just&nbsp;calculated.</p>
<p>The X distance from the map origin to the right boundary is |16384 - 7800| = 8584 pixels. Converting this to in-game coordinates is 8584 * 5389.603515625/4960 = 9327.49124559. So the corresponding in-game X coordinate of my image&#8217;s right boundary is 9327.49124559 units from the origin. Since the in-game map origin is (0, 0), then the right boundary is just 0 + 9327.49124559 =&nbsp;9327.49124559.</p>
<p>The left boundary calculation is -7800 * 5389.603515625/4960 =&nbsp;-8475.58617377</p>
<p>So now I know that the X bounds on my image [0, 16384] map to [-8475.58617377, 9327.49124559]&nbsp;in-game.</p>
<p>Using the same method for the Y bounds I get [9028.52473332, -8836.61406266]. One thing to note is that the direction the Y component increases in the image pixel coordinate system is opposite the in-game coordinate system which is why the order is different. You can also see how this is accounted for in the coordinate conversion code used in my interactive map. <a href="https://github.com/devilesk/dota-interactive-map/blob/master/src/interactivemap.js#L206">Image to in-game</a> and <a href="https://github.com/devilesk/dota-interactive-map/blob/master/src/interactivemap.js#L216">in-game to&nbsp;image</a></p>
<p>So the top left of the image (0, 0) in pixels is (-8475.58617377, 9028.52473332) in-game and bottom right in the image (16384, 16384) is (9327.49124559, -8836.61406266) in-game. You can see the values appearing in the code <a href="https://github.com/devilesk/dota-interactive-map/blob/master/src/interactivemap.js#L22-L23">here</a></p>
<h2>Creating&nbsp;Tiles</h2>
<p>The last thing I need to do to make these images usable in my interactive map is split them into&nbsp;tiles.</p>
<p>I use <a href="http://www.imagemagick.org/">ImageMagick</a> to do the splitting. Here&#8217;s the batch script I&nbsp;made.</p>
<script src="https://gist.github.com/devilesk/9b9895355993fabeb0523884f53b9a21.js"></script>

<p>The first few lines just set up 5 folders numbered 0 to 5 and makes sure they&#8217;re empty. Then I start by converting the png I have to a lower quality jpg because I don&#8217;t want to be using a 350mb+ image. I scale down the images and pad them to some multiple of 256, because 256 is my tile size. The last few lines do the splitting. I need to tell ImageMagick to do everything on disk and I specify a specific hard drive and folder for it, because doing everything in memory didn&#8217;t work. Splitting the first and largest image takes over an hour, but it is a very large image and it has to use disk for&nbsp;everything.</p>
<p>And that&#8217;s it. That&#8217;s how I create a dota map image for my interactive&nbsp;map.</p><hr>
<ul class="tags clear">
Tagged with:
<li>
    <a class="small" href="/blog/tags/Interactive%20Dota%20Map.html">Interactive Dota Map</a>
</li>
<li>
    <a class="small" href="/blog/tags/update.html">update</a>
</li>
<li>
    <a class="small" href="/blog/tags/Source%20Filmmaker.html">Source Filmmaker</a>
</li>
</ul>
<nav class="post_nav">
<a class="btn btn-default btn-xs backlink" href="/blog">Back to list</a>
<a class="btn btn-default btn-xs prev disabled"
    title=""
    >
    Previous
</a>

<a class="btn btn-default btn-xs next"
    title="Interactive Map Lane View Update"
        href="/blog/interactive-map-lane-view-update.html">
    Next
</a>
<a class="btn btn-default btn-xs backlink" href="#">Back to top</a>
</nav>
</article>
<hr>
<div id="disqus_thread"></div>        </section>
    </div>
    </div>
        
                    <div class="push"></div>
            </div>

        <footer>
        <img width="80" height="80" src="/media/images/footer.png">
        <p><a href="mailto:admin@devilesk.com">admin@devilesk.com</a></p>
        <p>Copyright &copy; 2016 <a href="http://devilesk.com">devilesk.com</a></p>
    </footer>
    
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="/media/bootstrap/js/bootstrap.js"></script>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'devileskdota';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script type="text/javascript">
$('link[href*="gist-embed"]').remove();
</script>            
    </body>
</html>